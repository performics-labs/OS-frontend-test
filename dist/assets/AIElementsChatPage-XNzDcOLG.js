import{an as G,a1 as x,ao as J,ap as K,u as Q,aq as V,ar as X,as as Y,A as Z,at as ee,au as se,av as P,j as e,W as O,i as _,aw as te,ax as ae,ay as ne,c as re,az as ie,aA as U,aB as z,aC as le,aD as oe,aE as B,aF as ce,aG as de,a2 as q,aH as H,aI as ue,aJ as xe,aK as he,aL as me,aM as ge,aN as F,X as je,aO as pe,aP as fe,aQ as ve}from"./index-0i5ZKW7Y.js";import{R as be}from"./refresh-ccw-8UJs6NXq.js";const Ce="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ye=(t=21)=>{let i="",h=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)i+=Ce[h[t]&63];return i};function A(t){return t.parts.filter(i=>i.type==="text").map(i=>i.type==="text"?i.text:"").join("")}function W(t){return t.error!==void 0&&t.error!==null?"output-error":t.output!==void 0||t.result!==void 0?"output-available":t.input!==void 0||t.args!==void 0?"input-available":"input-streaming"}function ke(){const{id:t}=G(),i=x.useRef(t||ye()).current,[h,j]=x.useState(null),[C,k]=x.useState({}),[y,p]=x.useState({}),[M,n]=x.useState(null),{data:N,isLoading:I}=J(t),{setDataStream:D,clearDataStream:T}=K(),{artifact:L,isOpen:S}=Q(),{messages:m,sendMessage:R,status:w,stop:s,regenerate:o}=V({id:i,messages:N,transport:new X({api:`${Y}${Z.CHAT}`,prepareSendMessagesRequest:({messages:a})=>{const r=ee.getState().currentModel,l=se.getState().user;return{body:{message:a[a.length-1].parts.filter(E=>E.type==="text").map(E=>"text"in E?E.text:"").join(""),context:{agentTemplate:r?.id||"default",chatId:i,userId:l?.user_id}}}}}),onData:a=>{typeof a=="object"&&a!==null&&"type"in a&&a.type==="start"&&T();const r=ie(a);r&&D(l=>[...l,r])},onFinish:()=>{T()},onError:a=>{P.error("Failed to send message",{description:a.message})}}),c=w==="streaming",d=x.useCallback((a,r)=>{navigator.clipboard.writeText(r),j(a),P.success("Copied to clipboard"),setTimeout(()=>j(null),2e3)},[]),f=x.useCallback((a,r)=>{k(l=>({...l,[a]:l[a]===r?null:r})),P.success(r==="like"?"Thanks for the feedback!":"Feedback recorded")},[]),v=x.useCallback(async a=>{const r=m.findIndex(u=>u.id===a);if(r===-1)return;const l=m[r];p(u=>({...u,[a]:[...u[a]||[],l]})),n(a),await o(),n(null)},[m,o]),b=x.useCallback((a,r)=>{if(!(!a.trim()&&r.length===0))if(r.length>0){const l=r.map(u=>({type:"file",url:URL.createObjectURL(u),filename:u.name,mediaType:u.type}));R({text:a||"",files:l})}else R({text:a})},[R]);return t&&I?e.jsx(O,{className:"flex h-[calc(100vh-4rem)] items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"border-primary mb-4 inline-block size-8 animate-spin rounded-full border-4 border-t-transparent"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading conversation..."})]})}):e.jsxs(O,{className:"flex h-[calc(100vh-4rem)] flex-col",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"AI Elements Chat"}),e.jsx(_,{variant:"default",children:"Full Implementation"}),t&&e.jsxs(_,{variant:"outline",children:["Thread: ",t.slice(0,8),"..."]})]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Complete implementation with threads, artifacts, tools, and files"})]}),e.jsxs("div",{className:"flex flex-1 gap-4 overflow-hidden",children:[e.jsxs("div",{className:`flex flex-col overflow-hidden rounded-lg border transition-all ${S?"w-[400px]":"flex-1"}`,children:[e.jsxs(te,{children:[e.jsx(Me,{messages:m,messageAlternatives:y,copiedMessageId:h,feedback:C,regeneratingMessageId:M,isLoading:c,onCopy:d,onFeedback:f,onRegenerate:v}),e.jsx(ae,{})]}),e.jsx("div",{className:"border-t p-4",children:e.jsx(ne,{onSubmit:b,placeholder:"Ask me anything...",isStreaming:c,disabled:c,hasStarted:m.length>0,onStop:s})})]}),S&&L&&e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(re,{})})]}),e.jsxs("div",{className:"bg-muted/50 mt-4 rounded-lg p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Features Active:"}),e.jsxs("div",{className:"grid gap-2 text-xs md:grid-cols-3 lg:grid-cols-4",children:[e.jsx(g,{active:!0,label:"Thread Persistence"}),e.jsx(g,{active:!0,label:"AI Elements Messages"}),e.jsx(g,{active:!0,label:"Message Branching"}),e.jsx(g,{active:!0,label:"Artifact System"}),e.jsx(g,{active:!0,label:"Tool Execution"}),e.jsx(g,{active:!0,label:"File Uploads"}),e.jsx(g,{active:!0,label:"Message Actions"}),e.jsx(g,{active:!0,label:"Model Selection"})]})]})]})}function Me({messages:t,messageAlternatives:i,copiedMessageId:h,feedback:j,regeneratingMessageId:C,isLoading:k,onCopy:y,onFeedback:p,onRegenerate:M}){return t.length===0?e.jsx("div",{className:"flex flex-1 items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-muted-foreground mb-2 text-lg font-medium",children:"No messages yet"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Start a conversation using the input below"})]})}):e.jsx("div",{className:"flex-1 space-y-6 p-6",children:t.map((n,N)=>{const I=i[n.id]||[],D=I.length>0,T=C===n.id,L=N===t.length-1,S=k&&L,m=n.parts.filter(s=>s.type==="file"),R=m.length>0,w=n.parts.filter(s=>s.type.startsWith("tool-"));return e.jsx("div",{children:n.role==="user"?e.jsx(U,{from:"user",children:e.jsxs(z,{children:[R&&e.jsx(le,{children:m.map((s,o)=>e.jsx(oe,{data:s},o))}),e.jsx(B,{children:A(n)})]})}):D?e.jsx(ce,{children:e.jsx(U,{from:"assistant",children:e.jsxs(z,{children:[e.jsxs(de,{children:[I.map(s=>e.jsx("div",{children:e.jsx(B,{children:A(s)})},s.id)),e.jsxs("div",{children:[w.map((s,o)=>{const c=s.type.replace("tool-",""),d=W(s),f="input"in s?s.input:"args"in s?s.args:void 0,v="output"in s?s.output:"result"in s?s.result:void 0,b="error"in s&&typeof s.error=="string"?s.error:void 0,a=q({toolName:c,state:d,input:f,output:v,error:b});return a?e.jsx("div",{className:"my-2",children:a},o):e.jsx(H,{toolName:c,toolCallId:"toolCallId"in s?String(s.toolCallId):"",status:d==="output-error"?"error":d==="output-available"?"complete":"streaming",input:f,output:v,error:b},o)}),e.jsx(B,{children:A(n)})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs(ue,{from:"assistant",children:[e.jsx(xe,{}),e.jsx(he,{}),e.jsx(me,{})]}),e.jsx($,{messageId:n.id,content:A(n),copiedMessageId:h,feedback:j,isRegenerating:T,isStreaming:S,onCopy:y,onFeedback:p,onRegenerate:M})]})]})})}):e.jsx(U,{from:"assistant",children:e.jsxs(z,{children:[w.map((s,o)=>{const c=s.type.replace("tool-",""),d=W(s),f="input"in s?s.input:"args"in s?s.args:void 0,v="output"in s?s.output:"result"in s?s.result:void 0,b="error"in s&&typeof s.error=="string"?s.error:void 0,a=q({toolName:c,state:d,input:f,output:v,error:b});return a?e.jsx("div",{className:"my-2",children:a},o):e.jsx(H,{toolName:c,toolCallId:"toolCallId"in s?String(s.toolCallId):"",status:d==="output-error"?"error":d==="output-available"?"complete":"streaming",input:f,output:v,error:b},o)}),e.jsx(B,{children:A(n)}),!S&&e.jsx($,{messageId:n.id,content:A(n),copiedMessageId:h,feedback:j,isRegenerating:T,isStreaming:S,onCopy:y,onFeedback:p,onRegenerate:M})]})})},n.id)})})}function $({messageId:t,content:i,copiedMessageId:h,feedback:j,isRegenerating:C,isStreaming:k,onCopy:y,onFeedback:p,onRegenerate:M}){const n=h===t,N=j[t];return e.jsxs(ge,{children:[e.jsx(F,{tooltip:n?"Copied!":"Copy",label:"Copy message",onClick:()=>y(t,i),children:n?e.jsx(je,{size:14}):e.jsx(pe,{size:14})}),e.jsx(F,{tooltip:"Like",label:"Like",variant:N==="like"?"default":"ghost",onClick:()=>p(t,"like"),children:e.jsx(fe,{size:14})}),e.jsx(F,{tooltip:"Dislike",label:"Dislike",variant:N==="dislike"?"default":"ghost",onClick:()=>p(t,"dislike"),children:e.jsx(ve,{size:14})}),e.jsx(F,{tooltip:"Regenerate response",label:"Regenerate",onClick:()=>M(t),disabled:C||k,children:e.jsx(be,{size:14,className:C?"animate-spin":""})})]})}function g({active:t,label:i}){return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:t?"text-green-600":"text-muted-foreground",children:t?"✓":"○"}),e.jsx("span",{className:"text-muted-foreground",children:i})]})}export{ke as AIElementsChatPage,ke as default};
